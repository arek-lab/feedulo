<form [formGroup]="formData" (ngSubmit)="onSubmit()">
  <!-- Główny kontener dashboard -->
  <div class="dashboard-container d-flex bg-dark">
    <!-- Przycisk toggle sidebar -->
    <button class="sidebar-toggle" #sidebarToggle type="button">
      <i class="fa-solid fa-sliders"></i>
    </button>

    <!-- Overlay dla małych ekranów -->
    <div class="sidebar-overlay" #sidebarOverlay></div>

    <!-- Sidebar -->
    <div class="sidebar bg-dark pt-5" #sidebar>
      <div class="sidebar-wrapper p-2 mt-3">
        <div class="mb-0 ps-2">Ustawienia dodatkowe</div>

        <!-- Pierwsza sekcja suwaków -->
        <div
          class="container-md p-2 d-flex flex-wrap mt-5 justify-content-start align-items-center"
        >
          <!-- Wrażliwość -->
          <div class="d-flex me-5 ms-5 flex-grow-1">
            <div class="range w-100">
              <label for="sensitivity" class="form-label w-100">
                wrażliwość na efekt ({{ sensitivity() }})
              </label>
              <div class="d-flex">
                <input
                  type="range"
                  class="form-range"
                  style="width: 100%"
                  min="0"
                  max="4"
                  step="1"
                  [value]="2"
                  name="sensitivity"
                  id="sensitivity"
                  formControlName="sensitivity"
                  (change)="sensitivityChange($event)"
                />
              </div>
            </div>
          </div>

          <!-- Historyczne -->
          <div class="me-5 ms-5 flex-fill">
            <div class="range historical">
              <label for="historical" class="form-label">
                wyniki historyczne ({{ historical() }})
              </label>
              <div class="d-flex align-items-center">
                <input
                  type="range"
                  class="form-range flex-grow-0 mt-1"
                  style="flex-basis: 85%"
                  min="0"
                  max="4"
                  step="1"
                  [value]
                  name="historical"
                  id="historical"
                  formControlName="historical"
                  (change)="historicalChange($event)"
                />
                <div
                  class="form-check form-switch form-check-reverse ms-3 flex-grow-0"
                  style="flex-basis: 15%"
                >
                  <input
                    class="form-check-input mt-2"
                    type="checkbox"
                    id="flexSwitchCheckChecked"
                    formControlName="ignoreHistorical"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>

        <hr class="border border-info border-0 opacity-100 mt-4 mb-2" />

        <!-- Rozwojowe, feedback opening/closing -->
        <div class="container-md p-2 d-flex flex-wrap justify-content-center align-items-start">
          <!-- Propozycje działań -->
          <section class="flex-grow-1 mt-2 p-2">
            <div>
              Propozycje działań rozwojowych (opcjonalnie)
              <svg
                (click)="onAddActivity()"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
                class="size-6"
              >
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
              </svg>
            </div>
            @if(developmentActivities.length > 0) {
            <ng-container formArrayName="developmentActivities">
              @for (d of developmentActivities.controls; track d; let i = $index){
              <div class="container-md p-2 d-flex justify-content-center align-items-center">
                <div class="me-2 flex-grow-1">
                  <label for="activity" class="visually-hidden">activity</label>
                  <input
                    type="text"
                    class="form-control dark"
                    id="activity"
                    placeholder="proponowane działanie"
                    [formControlName]="i"
                  />
                </div>
                <svg
                  (click)="onRemoveActivity(i)"
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke-width="1.5"
                  stroke="currentColor"
                  class="size-6 bin"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"
                  />
                </svg>
              </div>
              }
            </ng-container>
            }
          </section>

          <!-- Początek feedbacku -->
          <section class="flex-grow-1 mt-2 p-2">
            <div>
              Propozycja rozpoczęcia feedbacku (opcjonalnie) @if(!showOpeningSentence()) {
              <svg
                (click)="showOpeningSentence.set(!showOpeningSentence())"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
                class="size-6"
              >
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
              </svg>
              }@else {
              <svg
                (click)="showOpeningSentence.set(!showOpeningSentence())"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
                class="size-6"
              >
                <path stroke-linecap="round" stroke-linejoin="round" d="M5 12h14" />
              </svg>

              }
            </div>
            @if(showOpeningSentence()) {
            <div class="container-md p-2 d-flex justify-content-center align-items-center">
              <div class="me-2 flex-grow-1">
                <label for="openingSentence" class="visually-hidden">openingSentence</label>
                <input
                  type="text"
                  class="form-control"
                  id="openingSentence"
                  placeholder="Początek feedbacku"
                  formControlName="openingSentence"
                />
              </div>
            </div>
            }
          </section>

          <!-- Zakończenie feedbacku -->
          <section class="flex-grow-1 mt-2 p-2">
            <div>
              Propozycja zakończenia feedbacku (opcjonalnie) @if(!showClosingSentence()) {
              <svg
                (click)="showClosingSentence.set(!showClosingSentence())"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
                class="size-6"
              >
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
              </svg>
              }@else {
              <svg
                (click)="showClosingSentence.set(!showClosingSentence())"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
                class="size-6"
              >
                <path stroke-linecap="round" stroke-linejoin="round" d="M5 12h14" />
              </svg>

              }
            </div>
            @if(showClosingSentence()) {
            <div class="container-md p-2 d-flex justify-content-center align-items-center">
              <div class="me-2 flex-grow-1">
                <label for="closingSentence" class="visually-hidden">closingSentence</label>
                <input
                  type="text"
                  class="form-control dark"
                  id="closingSentence"
                  placeholder="Zakończenie feedbacku"
                  formControlName="closingSentence"
                />
              </div>
            </div>
            }
          </section>
        </div>

        <!-- Więcej opcji -->
        <div class="container-md">
          <section class="mt-3 p-2">
            <div>
              @if(!showMoreOptions()) { Więcej opcji
              <svg
                (click)="showMoreOptions.set(!showMoreOptions())"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
                class="size-6"
              >
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
              </svg>
              }@else { Mniej opcji
              <svg
                (click)="showMoreOptions.set(!showMoreOptions())"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
                class="size-6"
              >
                <path stroke-linecap="round" stroke-linejoin="round" d="M5 12h14" />
              </svg>

              }
            </div>
            @if(showMoreOptions()) {
            <div
              class="container-md p-2 d-flex flex-wrap justify-content-center align-items-center"
            >
              <div class="option d-flex flex-grow-1 me-2 mb-3">
                <label for="MoreOptions" class="form-label flex-grow-1">
                  Liczba wyrazów feedbacku
                </label>
                <div class="numberOfWords text-center flex-grow-1">
                  <label for="numberOfWords1">100</label>
                  <input
                    type="radio"
                    class="form-control dark w-25"
                    id="numberOfWords1"
                    name="numberOfWords"
                    value="100"
                    formControlName="numberOfWords"
                  />
                </div>
                <div class="flex-grow-1 numberOfWords text-center">
                  <label for="numberOfWords2">200</label>
                  <input
                    type="radio"
                    class="form-control dark w-25"
                    id="numberOfWords2"
                    name="numberOfWords"
                    value="200"
                    formControlName="numberOfWords"
                  />
                </div>
                <div class="flex-grow-1 numberOfWords text-center">
                  <label for="numberOfWords3">300</label>
                  <input
                    type="radio"
                    class="form-control dark w-25"
                    id="numberOfWords3"
                    name="numberOfWords"
                    value="300"
                    formControlName="numberOfWords"
                  />
                </div>
              </div>

              <!-- Emocje -->
              <div class="option flex-grow-1 me-2 mb-3">
                <label for="MoreOptions" class="form-label"> Emocje do pokazania </label>
                <textarea
                  rows="3"
                  type="text"
                  class="form-control dark"
                  id="MoreOptions"
                  placeholder="np. zadowolenie, wdzięczność"
                  formControlName="emotions"
                ></textarea>
              </div>

              <!-- Dodatkowe info -->
              <div class="option flex-grow-1 me-2 mb-3">
                <label for="MoreOptions" class="form-label"> Dodatkowe informacje </label>
                <textarea
                  rows="3"
                  type="text"
                  class="form-control dark"
                  id="MoreOptions"
                  placeholder="np. sumienność, spóźnianie się"
                  formControlName="moreInfos"
                ></textarea>
              </div>
            </div>
            }
          </section>
        </div>
      </div>
    </div>

    <!-- Główna przestrzeń robocza -->
    <div class="main-content flex-fill bg-dark" #mainContent>
      <!-- Górna sekcja (60% wysokości) -->
      <div
        class="workspace-top bg-dark text-center"
        [style.height]="!showResponse() ? '100%' : '0%'"
      >
        <div
          class="workspace-header mb-3 mt-3 mb-5 d-flex justify-content-between align-items-center"
        >
          <div class="flex-grow-1">Dostosuj parametry</div>
          <span class="me-2"> {{ credits() }} <i class="bi bi-coin"></i></span>
        </div>
        <div class="cue-info mb-2 text-start mt-3 ms-3">Wybierz swój styl zarządzania</div>

        <div class="d-flex justify-content-center align-items-center p-2 container-md flex-wrap">
          <div class="flex-grow-1 option">
            <div class="rainbow-box d-flex g-2">
              <div class="flex-grow-1 w-sm-50 w-md-25">
                <input type="radio" name="colors" value="1" id="radio1" formControlName="colors" />
                <label for="radio1">Ewolucyjny turkus</label>
              </div>
              <div class="flex-grow-1 w-sm-50 w-md-25">
                <input type="radio" name="colors" id="radio2" value="2" formControlName="colors" />
                <label for="radio2">Pluralistyczna zieleń</label>
              </div>
              <div class="flex-grow-1 w-sm-50 w-md-25">
                <input
                  type="radio"
                  name="colors"
                  id="radio3"
                  value="3"
                  checked
                  formControlName="colors"
                />
                <label for="radio3">Oranż osiągnięć</label>
              </div>
              <div class="flex-grow-1 w-sm-50 w-md-25">
                <input type="radio" name="colors" id="radio4" value="4" formControlName="colors" />
                <label for="radio4">Konformistyczny bursztyn</label>
              </div>
              <div class="flex-grow-1 w-sm-50 w-md-25">
                <input type="radio" name="colors" id="radio5" value="5" formControlName="colors" />
                <label for="radio5">Impulsywna czerwień</label>
              </div>
            </div>
          </div>
        </div>
        <div class="cue-info mb-2 text-start mt-3 ms-3 d-flex align-items-center">
          Wskaż zadania i efekty
          <svg
            (click)="onAddInputs()"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="size-6 add ms-2"
          >
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
          </svg>
        </div>
        <ng-container formArrayName="productResults">
          @for (p of productResults.controls; track p; let i = $index){
          <div
            class="d-flex flex-wrap justify-content-start align-items-center p-2 container-md"
            [formGroupName]="i"
          >
            <!-- text input -->
            <div class="me-2 flex-grow-1">
              <label for="product" class="visually-hidden">product</label>
              <input
                type="text"
                class="form-control dark"
                id="product"
                placeholder="zadanie do wykonania"
                formControlName="product"
              />
            </div>
            <!-- select -->
            <!-- <div class="me-2 flex-grow-1">
                <label for="product" class="visually-hidden">product</label>
                <select
                  class="form-select dark"
                  aria-label="Default select example"
                  formControlName="product"
                  placeholder="produkt"
                >
                  <option value="" disabled hidden>wybierz produkt</option>
                  <option value="rachunki osobiste">Rachunki Osobiste</option>
                  <option value="kredyty gotówkowe">Kredyty Gotówkowe</option>
                  <option value="karty kredytowe">Karty Kredytowe</option>
                </select>
              </div> -->

            <div class="me-2 flex-shrink-1">
              <label for="result" class="visually-hidden">result</label>
              <input
                type="text"
                class="form-control"
                id="result"
                placeholder="jaki był efekt"
                formControlName="result"
              />
            </div>
            <div class="flex-grow-1 me-3">
              <label for="additional" class="visually-hidden">additional</label>
              <input
                type="text"
                class="form-control dark"
                id="additional"
                placeholder="dodatkowe uwagi (opcjonalnie)"
                formControlName="additional"
              />
            </div>
            <div>
              <svg
                (click)="onRemoveInput(i)"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
                class="size-6 bin"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"
                />
              </svg>
            </div>
          </div>
          }
        </ng-container>
        <div class="row mt-5 g-2 justify-content-center px-3">
          <div class="col-12 col-sm-auto">
            <button
              class="btn btn-primary w-100 w-md-auto px-5"
              type="submit"
              [ngClass]="{ inactive: formData.invalid }"
            >
              generuj feedback
            </button>
          </div>
          <div class="col-12 col-sm-auto">
            <div
              class="btn btn-outline-light w-100 w-md-auto px-5"
              type="button"
              (click)="onClear()"
            >
              wyczyść
            </div>
          </div>
        </div>
        <!-- <div class="container mt-5 mb-3">
          <div class="row justify-content-center gx-3 gy-3 px-3">
            <div class="col-12 col-sm-5 col-md-4">
              <button
                class="btn btn-primary w-100"
                type="submit"
                [ngClass]="{ disabled: formData.invalid }"
              >
                generuj feedback
              </button>
            </div>
            <div class="col-12 col-sm-5 col-md-4">
              <button class="btn btn-outline-light btn-lg w-100" type="button" (click)="onClear()">
                wyczyść
              </button>
            </div>
          </div>
        </div> -->
      </div>

      <!-- Dolna sekcja -->
      <div
        class="workspace-bottom bg-dark text-center"
        [style.height]="showResponse() ? '100%' : '0%'"
      >
        <div class="workspace-header"><app-chat-response /></div>
      </div>
    </div>
  </div>
</form>
